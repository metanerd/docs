


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SSL Client Certificate Setup (Beta) &mdash; Mattermost 5.31 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme.css" type="text/css" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Certificate-Based Authentication (Experimental)" href="certificate-based-authentication.html" />
    <link rel="prev" title="Office 365 Single Sign-On (E20)" href="sso-office.html" />
	<!-- Google Tag Manager -->
	<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-K874RWM');</script>
	<!-- End Google Tag Manager -->


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Mattermost
          

          
          </a>

          
            
            
              <div class="version">
                5.31
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/cloud-admin-guide.html">Cloud Administrator's Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../guides/administrator.html">Self-Managed Administrator's Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview/architecture.html">Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="deployment.html">Deployment Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#installing-mattermost">Installing Mattermost</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#deployment">Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#configure-mattermost">Configure Mattermost</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#incident-collaboration">Incident Collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#mobile-apps">Mobile Apps</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../guides/administrator.html#onboard-users">Onboard Users</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="bulk-loading.html">Bulk Loading Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration/migrating.html">Migration Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration/hipchat-migration-guidelines.html">Migrating from HipChat to Mattermost</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration/migration-announcement-email-template.html">Migration Announcement Email</a></li>
<li class="toctree-l3"><a class="reference internal" href="../administration/user-provisioning.html">Provisioning Workflows</a></li>
<li class="toctree-l3"><a class="reference internal" href="admin-roles.html">Additional System Admin Roles (E20)</a></li>
<li class="toctree-l3"><a class="reference internal" href="sso-ldap.html">Active Directory/LDAP Setup (E10/E20)</a></li>
<li class="toctree-l3"><a class="reference internal" href="auth.html">Multi-factor Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="ldap-group-sync.html">AD/LDAP Groups (E20)</a></li>
<li class="toctree-l3"><a class="reference internal" href="ldap-group-constrained-team-channel.html">Using AD/LDAP Synchronized Groups to Manage Team or Private Channel Membership</a></li>
<li class="toctree-l3"><a class="reference internal" href="sso-saml.html">SAML Single Sign-On (E20)</a></li>
<li class="toctree-l3"><a class="reference internal" href="sso-saml-technical.html">SAML Single-Sign-On (E20): Technical Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="sso-gitlab.html">GitLab Single Sign-On</a></li>
<li class="toctree-l3"><a class="reference internal" href="sso-google.html">Google Single Sign-On (E20)</a></li>
<li class="toctree-l3"><a class="reference internal" href="sso-office.html">Office 365 Single Sign-On (E20)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">SSL Client Certificate Setup (Beta)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#set-up-mutual-tls-authentication-for-the-web-app">Set up mutual TLS authentication for the Web App</a></li>
<li class="toctree-l4"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="certificate-based-authentication.html">Certificate-Based Authentication (Experimental)</a></li>
<li class="toctree-l3"><a class="reference internal" href="team-channel-management.html">Managing Team and Channel Members (E20)</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced-permissions.html">Advanced Permissions (E10/E20)</a></li>
<li class="toctree-l3"><a class="reference internal" href="permissions-backend.html">Advanced Permissions: Backend Infrastructure</a></li>
<li class="toctree-l3"><a class="reference internal" href="guest-accounts.html">Guest Accounts (Beta) (E10/E20)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#administration">Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#upgrade-mattermost">Upgrade Mattermost</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#mattermost-integrations">Mattermost Integrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#mattermost-compliance">Mattermost Compliance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#scaling-mattermost">Scaling Mattermost</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides/administrator.html#community-managed-documentation">Community-Managed Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../guides/user.html">User's Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/integration.html">Integration Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://developers.mattermost.com/">Developer's Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Mattermost</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          


  


<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      <li><a href="../guides/administrator.html">Self-Managed Administrator’s Guide</a> &raquo;</li>
    
    <li>SSL Client Certificate Setup (Beta)</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/mattermost/docs/blob/master/source/deployment/ssl-client-certificate.rst" class="fa fa-github"> Edit</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ssl-client-certificate-setup-beta">
<h1>SSL Client Certificate Setup (Beta)<a class="headerlink" href="#ssl-client-certificate-setup-beta" title="Permalink to this headline">¶</a></h1>
<p>Follow these steps to configure SSL client certificates for your browser and the Mattermost Desktop Apps on Windows, Mac and Linux. SSL client certificates are not yet supported on the Mattermost mobile apps.</p>
<p>Before you begin, follow the <a class="reference external" href="https://docs.mattermost.com/guides/administrator.html#installing-mattermost">official guides to install Mattermost</a> on your system, including NGINX configuration as a proxy with SSL and HTTP/2, and a valid SSL certificate such as Let’s Encrypt.</p>
<p>For the purposes of this guide, the Mattermost server domain name is <code class="docutils literal notranslate"><span class="pre">example.mattermost.com</span></code>, and the user account is <code class="docutils literal notranslate"><span class="pre">mmuser</span></code> with email <code class="docutils literal notranslate"><span class="pre">mmuser&#64;mattermost.com</span></code> and password <code class="docutils literal notranslate"><span class="pre">mmuser-password</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Generating the client certificates in this section is optional if you have already generated them before.</p>
</div>
<div class="section" id="set-up-mutual-tls-authentication-for-the-web-app">
<h2>Set up mutual TLS authentication for the Web App<a class="headerlink" href="#set-up-mutual-tls-authentication-for-the-web-app" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Create a <a class="reference external" href="https://en.wikipedia.org/wiki/Certificate_authority">certificate authority (CA) key</a> and a certificate for signing the client certificate. When establishing a TLS connection, the NGINX proxy server requests and validates a client certificate provided by the web app.</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>openssl genrsa -des3 -out ca.mattermost.key 4096

pass phrase: capassword
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>openssl req -new -x509 -days 365 -key ca.mattermost.key -out ca.mattermost.crt

Country Name: US
State: Maryland
Locality Name: Meade
Organization Name: Mattermost
Organization Unit: Smarttotem
Common Name: example.mattermost.com
Email Address: admin@mattermost.com
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Create the client side key for <code class="docutils literal notranslate"><span class="pre">mmuser</span></code> with a passphrase, and the certificate signing request:</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>openssl genrsa -des3 -out mmuser-mattermost.key 1024

passphrase: mmuser-passphrase
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>openssl req -new -key mmuser-mattermost.key -out mmuser-mattermost.csr

Country Name: US
State: Maryland
Locality Name: Meade
Organization Name: Mattermost
Organization Unit: Smarttotem
Common Name: mmuser
Email Address: mmuser@mattermost.com

Challenge password: mmuser-passphrase
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Sign the user’s client certificate with the previously created CA certificate:</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>openssl x509 -req -days 365 -in mmuser-mattermost.csr -CA ca.mattermost.crt -CAkey ca.mattermost.key -set_serial 01 -out mmuser-mattermost.crt
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Check the newly generated client certificate for <code class="docutils literal notranslate"><span class="pre">mmuser</span></code>:</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>openssl x509 -in mmuser-mattermost.crt -text -noout
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li>Open the file <code class="docutils literal notranslate"><span class="pre">/etc/nginx/sites-available/mattermost</span></code> and modify the following lines, so that the NGINX proxy server requests and verifies the client certificate:</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ssl on;
ssl_certificate /etc/letsencrypt/live/example.mattermost.com/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/example.mattermost.com/privkey.pem;
<span class="hll">ssl_client_certificate /opt/mattermost/config/ca.mattermost.crt;
</span><span class="hll">ssl_verify_client on;
</span>
...

location ~ /api/v[0-9]+/(users/)?websocket$ {
<span class="hll"> proxy_set_header X-SSL-Client-Cert $ssl_client_cert;
</span><span class="hll"> proxy_set_header X-SSL-Client-Cert-Subject-DN $ssl_client_s_dn;
</span>
...

location / {
<span class="hll"> proxy_set_header X-SSL-Client-Cert $ssl_client_cert;
</span><span class="hll"> proxy_set_header X-SSL-Client-Cert-Subject-DN $ssl_client_s_dn;
</span>
...
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li>Confirm the CA key for <code class="docutils literal notranslate"><span class="pre">mmuser</span></code> works by the following curl command to the proxy:</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>curl -v -s -k --key mmuser-mattermost.key --cert mmuser-mattermost.crt:mmuser-passphrase https://example.mattermost.com
</pre></div>
</div>
<p>You should see the Mattermost login page. If you see:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">No</span> <span class="pre">required</span> <span class="pre">SSL</span> <span class="pre">certificate</span> <span class="pre">was</span> <span class="pre">sent</span></code>, something went wrong. Review the above steps and try again.</li>
<li><code class="docutils literal notranslate"><span class="pre">Error</span> <span class="pre">reading</span> <span class="pre">X.509</span> <span class="pre">key</span> <span class="pre">or</span> <span class="pre">certificate</span> <span class="pre">file:</span> <span class="pre">Decryption</span> <span class="pre">has</span> <span class="pre">failed.</span></code>, make sure the passphrase is included together with the certificate, because curl doesn’t prompt for it separately.</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="7">
<li>Generate a PKCS12 file from the CA key and certificate, to install the certificate into your client machine for your browser to use:</li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>openssl pkcs12 -export -out mmuser-mattermost.p12 -inkey mmuser-mattermost.key -in mmuser-mattermost.crt -certfile ca.mattermost.crt

Enter Export Password: mmuser-passphrase
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li>Repeat steps 2-7 above for other users as needed.</li>
<li>Import the generated .p12 file in step 7 into your key chain. In the Chrome browser on macOS:</li>
</ol>
<blockquote>
<div><ol class="arabic simple">
<li>Go to <strong>Settings &gt; Advanced &gt; Privacy and security &gt; Manage certificates</strong>. This opens the Keychain Access app.</li>
<li>Go to <strong>File &gt; Import Items</strong> and select the <code class="docutils literal notranslate"><span class="pre">mmuser-mattermost.p12</span></code> file.</li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="10">
<li>Go to <a class="reference external" href="https://example.mattermost.com">https://example.mattermost.com</a>. You should see a popup for the client certificate request.</li>
</ol>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://mattermost.org/troubleshoot/">Follow this process</a> to resolve configuration issues and to ask for help.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="certificate-based-authentication.html" class="btn btn-neutral float-right" title="Certificate-Based Authentication (Experimental)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="sso-office.html" class="btn btn-neutral" title="Office 365 Single Sign-On (E20)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2020 Mattermost

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
 




<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-cog">&nbsp;&nbsp;Options</span>&nbsp;
        <span class="fa fa-angle-up"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Contribute</dt>
            <dd>
                <a href="https://github.com/mattermost/docs/issues">Report a Problem</a>
            </dd>
            
            <dd>
                <a href="https://github.com/mattermost/docs/blob/master/source/deployment/ssl-client-certificate.rst"> Edit on GitHub</a>
            </dd>
            
        </dl>
    </div>
</div>


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/myscript.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
	<header>
	<div class="header__container">
		<div class="search__icon">
			<i class="fa fa-search"></i>
		</div>
		<a href="https://docs.mattermost.com/" class="header__logo">
			<img width="176" src="https://about.mattermost.com/wp-content/uploads/2017/08/Mattermost-Logo-Blue.svg">
		</a>
		<div class="links__icon">
			<i class="fa fa-bars"></i>
		</div>
		<ul class="header__links">
			<li><a href="https://developers.mattermost.com/">Developers</a></li>
			<li><a href="https://mattermost.com/features/">Product</a></li>
			<li><a href="https://mattermost.com/pricing/">Pricing</a></li>
			<li><a href="https://mattermost.com/blog/">Blog</a></li>
			<li><a href="https://mattermost.com/download/">Download</a></li>
			<li><a href="https://mattermost.com/trial/">Trial</a></li>
		</ul>
		<div class="header__searchbar">
			<form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
                <input type="text" name="q" placeholder="Search by keyword" autofocus />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
            </form>
		</div>
	</div>
</header>
	<script type="text/javascript">
		/* Temporary fix for the search capability. Fix has been committed to the theme's master;
		   however, waiting a new release to the theme.  This fix should remain in place until that
		   time.  sphinx_rtd_theme is current v0.1.10a0. Commit for the fix in the
		   theme can be found at: https://github.com/snide/sphinx_rtd_theme/commit/a5e0e304
		 */
        if(DOCUMENTATION_OPTIONS) {
			DOCUMENTATION_OPTIONS.SOURCELINK_SUFFIX = '.txt'
        }
    </script>


</body>
</html>